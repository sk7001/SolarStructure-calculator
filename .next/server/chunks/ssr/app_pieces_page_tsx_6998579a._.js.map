{"version":3,"sources":["../../../../app/pieces/page.tsx","../../../../app/lib/piecesDb.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport Link from \"next/link\";\nimport { clearPieces, createPiece, deletePieceById, listPieces, type PieceRow } from \"../lib/piecesDb\";\n\nconst fieldClass =\n  \"w-full h-14 rounded-lg bg-gray-800 text-gray-100 border border-gray-700 px-4 \" +\n  \"text-base outline-none focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30\";\n\nconst cardClass = \"bg-gray-900 rounded-xl shadow-lg border border-gray-800\";\n\nexport default function PiecesPage() {\n  const [pieces, setPieces] = useState<PieceRow[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const [len, setLen] = useState(\"\");\n  const [qty, setQty] = useState(\"\");\n  const [note, setNote] = useState(\"\");\n\n  const refresh = async () => {\n    const rows = await listPieces();\n    setPieces(rows);\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        setLoading(true);\n        await refresh();\n      } catch (e: any) {\n        alert(e?.message || \"Failed to load pieces from cloud.\");\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  const totals = useMemo(() => {\n    return {\n      lines: pieces.length,\n      totalQty: pieces.reduce((s, p) => s + (Number(p.qty) || 0), 0),\n    };\n  }, [pieces]);\n\n  const onAdd = async () => {\n    if (!len || !qty) {\n      alert(\"Please fill Length and Quantity.\");\n      return;\n    }\n\n    const L = Number(len);\n    const Q = parseInt(qty, 10);\n\n    if (!(L > 0) || !(Q > 0)) {\n      alert(\"Length and Quantity must be > 0.\");\n      return;\n    }\n\n    try {\n      await createPiece({ len: L, qty: Q, note });\n      await refresh();\n\n      setLen(\"\");\n      setQty(\"\");\n      setNote(\"\");\n    } catch (e: any) {\n      alert(e?.message || \"Failed to add piece.\");\n    }\n  };\n\n  const onDelete = async (id: string) => {\n    const ok = confirm(\"Delete this inventory line?\");\n    if (!ok) return;\n\n    try {\n      await deletePieceById(id);\n      await refresh();\n    } catch (e: any) {\n      alert(e?.message || \"Failed to delete.\");\n    }\n  };\n\n  const onClear = async () => {\n    const ok = confirm(\"Clear ALL usable pieces inventory?\");\n    if (!ok) return;\n\n    try {\n      await clearPieces();\n      await refresh();\n    } catch (e: any) {\n      alert(e?.message || \"Failed to clear.\");\n    }\n  };\n\n  return (\n    <div className=\"bg-gray-950 min-h-screen text-gray-100\">\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"flex items-center justify-between gap-3\">\n          <h1 className=\"text-2xl font-bold\">Usable Pieces (Inventory)</h1>\n          <Link\n            href=\"/\"\n            className=\"rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors px-4 py-2 border border-gray-700\"\n          >\n            Back\n          </Link>\n        </div>\n\n        <div className={`${cardClass} p-6 mt-6`}>\n          <div className=\"text-gray-300 text-sm\">\n            Saved lines: <span className=\"text-gray-100 font-semibold\">{totals.lines}</span> | Total qty:{\" \"}\n            <span className=\"text-gray-100 font-semibold\">{totals.totalQty}</span>\n          </div>\n\n          <h2 className=\"text-xl font-semibold mt-4 mb-4\">Add usable piece</h2>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-gray-300 mb-2\">Length (inches)</label>\n              <input type=\"number\" value={len} onChange={(e) => setLen(e.target.value)} className={fieldClass} />\n            </div>\n\n            <div>\n              <label className=\"block text-gray-300 mb-2\">Quantity</label>\n              <input type=\"number\" value={qty} onChange={(e) => setQty(e.target.value)} className={fieldClass} />\n            </div>\n\n            <div className=\"md:col-span-2\">\n              <label className=\"block text-gray-300 mb-2\">Note (optional)</label>\n              <input value={note} onChange={(e) => setNote(e.target.value)} className={fieldClass} />\n            </div>\n          </div>\n\n          <button\n            type=\"button\"\n            onClick={onAdd}\n            className=\"mt-4 w-full bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white px-4 py-3 rounded-lg shadow-md transition\"\n          >\n            Add to inventory (Cloud)\n          </button>\n\n          <button\n            type=\"button\"\n            onClick={onClear}\n            className=\"mt-3 w-full bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-4 py-3 rounded-lg shadow-md transition\"\n          >\n            Clear inventory (Cloud)\n          </button>\n        </div>\n\n        <div className={`${cardClass} p-6 mt-6`}>\n          <h2 className=\"text-xl font-semibold mb-4\">Saved usable pieces</h2>\n\n          {loading ? (\n            <div className=\"text-gray-400\">Loading...</div>\n          ) : pieces.length === 0 ? (\n            <div className=\"text-gray-400\">No saved pieces.</div>\n          ) : (\n            <div className=\"space-y-3\">\n              {pieces.map((p) => (\n                <div\n                  key={p.id}\n                  className=\"rounded-xl border border-gray-800 bg-gray-950/40 p-4 flex items-start justify-between gap-3\"\n                >\n                  <div>\n                    <div className=\"text-gray-100 font-semibold\">\n                      {p.len}\" Ã— {p.qty}\n                    </div>\n                    {p.note ? <div className=\"text-gray-400 text-sm mt-1\">{p.note}</div> : null}\n                  </div>\n\n                  <button\n                    type=\"button\"\n                    onClick={() => onDelete(p.id)}\n                    className=\"shrink-0 rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors px-4 py-2 border border-gray-700\"\n                  >\n                    Delete\n                  </button>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { supabase } from \"./supabaseClient\";\n\nexport type PieceRow = {\n  id: string;\n  user_id: string;\n  len: number;\n  qty: number;\n  note: string;\n  created_at?: string;\n};\n\nasync function requireUserId() {\n  const { data, error } = await supabase.auth.getUser();\n  if (error) throw error;\n  if (!data?.user?.id) throw new Error(\"Not logged in.\");\n  return data.user.id;\n}\n\nexport async function listPieces(): Promise<PieceRow[]> {\n  await requireUserId();\n\n  const { data, error } = await supabase\n    .from(\"pieces\")\n    .select(\"*\")\n    .order(\"created_at\", { ascending: false });\n\n  if (error) throw error;\n  return (data || []) as PieceRow[];\n}\n\nexport async function createPiece(input: { len: number; qty: number; note?: string }) {\n  const userId = await requireUserId();\n\n  const { data, error } = await supabase\n    .from(\"pieces\")\n    .insert([\n      {\n        user_id: userId,\n        len: Number(input.len),\n        qty: Number(input.qty),\n        note: (input.note ?? \"\").trim(),\n      },\n    ])\n    .select(\"*\")\n    .single();\n\n  if (error) throw error;\n  return data as PieceRow;\n}\n\nexport async function deletePieceById(id: string) {\n  await requireUserId();\n\n  const { error } = await supabase.from(\"pieces\").delete().eq(\"id\", id);\n  if (error) throw error;\n  return true;\n}\n\nexport async function clearPieces() {\n  const userId = await requireUserId();\n\n  const { error } = await supabase.from(\"pieces\").delete().eq(\"user_id\", userId);\n  if (error) throw error;\n  return true;\n}\n"],"names":[],"mappings":"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"}