{"version":3,"sources":["../../../../app/lib/panelsDb.tsx","../../../../app/panels/page.tsx"],"sourcesContent":["import { supabase } from \"./supabaseClient\";\n\nexport type PanelRow = {\n  id: string;\n  user_id: string;\n  name: string;\n  width: number;\n  height: number;\n  description: string;\n  created_at?: string;\n  updated_at?: string;\n};\n\nconst DEFAULT_PANELS: Array<Pick<PanelRow, \"name\" | \"width\" | \"height\" | \"description\">> = [\n  // Put your current “hardcoded” panels here (examples below — replace with yours)\n  { name: \"540W\", width: 89.6, height: 44.7, description: \"Default model\" },\n  { name: \"550W\", width: 89.6, height: 44.7, description: \"Default model\" },\n];\n\nasync function requireUserId() {\n  const { data, error } = await supabase.auth.getUser();\n  if (error) throw error;\n  if (!data?.user?.id) throw new Error(\"Not logged in.\");\n  return data.user.id;\n}\n\n// Load panels from cloud\nexport async function listPanels(): Promise<PanelRow[]> {\n  await requireUserId();\n\n  const { data, error } = await supabase\n    .from(\"panels\")\n    .select(\"*\")\n    .order(\"created_at\", { ascending: false });\n\n  if (error) throw error;\n  return (data || []) as PanelRow[];\n}\n\n// Seed default panels ONCE per user (safe to call many times)\nexport async function seedDefaultPanelsIfEmpty() {\n  const userId = await requireUserId();\n\n  const existing = await listPanels();\n  if (existing.length > 0) return;\n\n  // Upsert so it won’t create duplicates if you rerun\n  const { error } = await supabase\n    .from(\"panels\")\n    .upsert(\n      DEFAULT_PANELS.map((p) => ({\n        user_id: userId,\n        name: p.name,\n        width: p.width,\n        height: p.height,\n        description: p.description ?? \"\",\n      })),\n      { onConflict: \"user_id,name\" }\n    );\n\n  if (error) throw error;\n}\n\nexport async function createPanel(input: {\n  name: string;\n  width: number;\n  height: number;\n  description?: string;\n}) {\n  const userId = await requireUserId();\n\n  const { data, error } = await supabase\n    .from(\"panels\")\n    .insert([\n      {\n        user_id: userId,\n        name: input.name.trim(),\n        width: Number(input.width),\n        height: Number(input.height),\n        description: (input.description ?? \"\").trim(),\n      },\n    ])\n    .select(\"*\")\n    .single();\n\n  if (error) throw error;\n  return data as PanelRow;\n}\n\nexport async function getPanelById(id: string) {\n  await requireUserId();\n\n  const { data, error } = await supabase.from(\"panels\").select(\"*\").eq(\"id\", id).single();\n  if (error) throw error;\n  return data as PanelRow;\n}\n\nexport async function updatePanel(\n  id: string,\n  patch: { name: string; width: number; height: number; description?: string }\n) {\n  await requireUserId();\n\n  const { data, error } = await supabase\n    .from(\"panels\")\n    .update({\n      name: patch.name.trim(),\n      width: Number(patch.width),\n      height: Number(patch.height),\n      description: (patch.description ?? \"\").trim(),\n      updated_at: new Date().toISOString(),\n    })\n    .eq(\"id\", id)\n    .select(\"*\")\n    .single();\n\n  if (error) throw error;\n  return data as PanelRow;\n}\n\nexport async function deletePanel(id: string) {\n  await requireUserId();\n\n  const { error } = await supabase.from(\"panels\").delete().eq(\"id\", id);\n  if (error) throw error;\n  return true;\n}\n","\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { createPanel, listPanels, seedDefaultPanelsIfEmpty, type PanelRow } from \"../lib/panelsDb\";\n\nconst fieldClass =\n  \"w-full h-14 rounded-lg bg-gray-800 text-gray-100 border border-gray-700 px-4 \" +\n  \"text-base outline-none focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30\";\n\nconst cardClass = \"bg-gray-900 rounded-xl shadow-lg border border-gray-800\";\n\nexport default function PanelsPage() {\n  const [panels, setPanels] = useState<PanelRow[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const [name, setName] = useState(\"\");\n  const [width, setWidth] = useState(\"\");\n  const [height, setHeight] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n\n  const refresh = async () => {\n    const rows = await listPanels();\n    setPanels(rows);\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        setLoading(true);\n        await seedDefaultPanelsIfEmpty(); // optional: keep your “hardcoded” ones by pushing once\n        await refresh();\n      } catch (e: any) {\n        alert(e?.message || \"Failed to load panels from cloud.\");\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  const onAdd = async () => {\n    if (!name || !width || !height) {\n      alert(\"Please fill Name, Width, Height.\");\n      return;\n    }\n\n    try {\n      await createPanel({\n        name,\n        width: Number(width),\n        height: Number(height),\n        description,\n      });\n\n      await refresh();\n\n      setName(\"\");\n      setWidth(\"\");\n      setHeight(\"\");\n      setDescription(\"\");\n    } catch (e: any) {\n      alert(e?.message || \"Failed to add panel.\");\n    }\n  };\n\n  return (\n    <div className=\"bg-gray-950 min-h-screen text-gray-100\">\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"flex items-center justify-between gap-3\">\n          <h1 className=\"text-2xl font-bold\">Panel Models</h1>\n          <Link\n            href=\"/\"\n            className=\"rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors px-4 py-2 border border-gray-700\"\n          >\n            Back\n          </Link>\n        </div>\n\n        <div className={`${cardClass} p-6 mt-6`}>\n          <h2 className=\"text-xl font-semibold mb-4\">Add panel</h2>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-gray-300 mb-2\">Name</label>\n              <input value={name} onChange={(e) => setName(e.target.value)} className={fieldClass} />\n            </div>\n\n            <div>\n              <label className=\"block text-gray-300 mb-2\">Description</label>\n              <input value={description} onChange={(e) => setDescription(e.target.value)} className={fieldClass} />\n            </div>\n\n            <div>\n              <label className=\"block text-gray-300 mb-2\">Width (in)</label>\n              <input type=\"number\" value={width} onChange={(e) => setWidth(e.target.value)} className={fieldClass} />\n            </div>\n\n            <div>\n              <label className=\"block text-gray-300 mb-2\">Height (in)</label>\n              <input type=\"number\" value={height} onChange={(e) => setHeight(e.target.value)} className={fieldClass} />\n            </div>\n          </div>\n\n          <button\n            type=\"button\"\n            onClick={onAdd}\n            className=\"mt-4 w-full bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white px-4 py-3 rounded-lg shadow-md transition\"\n          >\n            Add Panel (Cloud)\n          </button>\n        </div>\n\n        <div className={`${cardClass} p-6 mt-6`}>\n          <h2 className=\"text-xl font-semibold mb-4\">Saved panels</h2>\n\n          {loading ? (\n            <div className=\"text-gray-400\">Loading...</div>\n          ) : panels.length === 0 ? (\n            <div className=\"text-gray-400\">No panels found.</div>\n          ) : (\n            <div className=\"space-y-3\">\n              {panels.map((p) => (\n                <div\n                  key={p.id}\n                  className=\"rounded-xl border border-gray-800 bg-gray-950/40 p-4 flex items-start justify-between gap-3\"\n                >\n                  <div>\n                    <div className=\"text-gray-100 font-semibold\">{p.name}</div>\n                    <div className=\"text-gray-300 text-sm mt-1\">\n                      {p.width} × {p.height} (in)\n                    </div>\n                    {p.description ? <div className=\"text-gray-400 text-sm mt-1\">{p.description}</div> : null}\n                  </div>\n\n                  <Link\n                    href={`/panels/${p.id}`}\n                    className=\"shrink-0 rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors px-4 py-2 border border-gray-700\"\n                  >\n                    Edit\n                  </Link>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}